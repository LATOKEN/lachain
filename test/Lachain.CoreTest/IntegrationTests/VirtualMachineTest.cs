using System;
using System.IO;
using System.Reflection;
using Lachain.Core.Blockchain.VM;
using Lachain.Core.CLI;
using Lachain.Core.Config;
using Lachain.Core.DI;
using Lachain.Core.DI.Modules;
using Lachain.Core.DI.SimpleInjector;
using Lachain.Proto;
using Lachain.Storage.State;
using Lachain.Utility;
using Lachain.Utility.Utils;
using Lachain.UtilityTest;
using NUnit.Framework;

namespace Lachain.CoreTest.IntegrationTests
{
    public class VirtualMachineTest
    {
        private IContainer _container;

        [SetUp]
        public void Setup()
        {
            TestUtils.DeleteTestChainData();

            var containerBuilder = new SimpleInjectorContainerBuilder(new ConfigManager(
                Path.Join(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), "config.json"),
                new RunOptions()
            ));

            containerBuilder.RegisterModule<BlockchainModule>();
            containerBuilder.RegisterModule<ConfigModule>();
            containerBuilder.RegisterModule<StorageModule>();

            _container = containerBuilder.Build();
        }

        [TearDown]
        public void Teardown()
        {
            _container.Dispose();

            TestUtils.DeleteTestChainData();
        }

        [Test]
        public void Test_VirtualMachine_InvokeContract()
        {
            var stateManager = _container.Resolve<IStateManager>();

            var hash = UInt160Utils.Zero;
            var contract = new Contract
            (
                hash,
                "0061736D01000000016A0D60017F0060037F7F7F0060027F7F006000017F60000060017F017F60037F7F7F017F600B7E7E7E7E7E7E7E7E7E7E7F017F600A7E7E7E7E7E7E7E7E7E7E017F60087E7E7E7E7E7E7E7F017F60047E7E7E7F017F60077E7E7E7E7E7E7E017F60077E7E7E7E7E7E7F017F02C8010A03656E760A6765745F73656E646572000003656E761063727970746F5F6B656363616B323536000103656E760C6C6F61645F73746F72616765000203656E760A7365745F72657475726E000203656E760B73797374656D5F68616C74000003656E760C736176655F73746F72616765000203656E760977726974655F6C6F67000203656E76156765745F7472616E736665727265645F66756E6473000003656E760D6765745F63616C6C5F73697A65000303656E760F636F70795F63616C6C5F76616C75650001031312010204050101010607080809090A0B0C0B040405017001010105030100020608017F01418080040B071202066D656D6F72790200057374617274001B0A8859122E0002402002450D000340200020012D00003A0000200041016A2100200141016A21012002417F6A22020D000B0B0B1C00034020004200370300200041086A21002001417F6A22010D000B0B2E004100410036028080044100410036028480044100410036028C800441003F0041107441F0FF7B6A36028880040BA60101047F418080042101024003400240200128020C0D002001280208220220004F0D020B200128020022010D000B41002101410028020821020B02402002200041076A41787122036B22024118490D00200120036A41106A22002001280200220436020002402004450D00200420003602040B2000200241706A3602082000410036020C2000200136020420012000360200200120033602080B2001410136020C200141106A0B2D002000411F6A21000340200120002D00003A0000200141016A21012000417F6A21002002417F6A22020D000B0B2D002001411F6A21010340200120002D00003A00002001417F6A2101200041016A21002002417F6A22020D000B0B29002001417F6A21010340200120026A20002D00003A0000200041016A21002002417F6A22020D000B0B7E01017F200120006C220141086A100D2203200036020420032000360200200341086A2100024002402002417F460D002001450D010340200020022D00003A0000200041016A2100200241016A21022001417F6A22010D000C020B0B2001450D000340200041003A0000200041016A21002001417F6A22010D000B0B20030B810703047F047E017F230041206B220B210C200B24000240024002400240024020002001200220032004200520062007200820091013220D0D00200B41606A220B220D2400200C41086A1000200B200C41086A41086A290300370308200B200C290308370300200B200C41086A41106A3502003E02104101450D01200B41106A3502002103200B41086A2903002104200B2903002105200D41406A220B220D2400200B41286A2001370300200B41206A2000370300200B41306A20023E0200200B41186A4200370300200B4200370310200B4200370308200B4201370300200D41606A220D220E2400200B4138200D1001200D290300210F200D41086A2903002110200D41106A2903002111200D41186A2903002112200E41406A220B220D2400200B41286A2004370300200B41206A2005370300200B41306A20033E0200200B41186A2012370300200B2011370310200B2010370308200B200F370300200D41606A220D220E2400200B4138200D1001200D2903002103200D41086A2903002104200D41106A2903002105200D41186A290300210F200E41606A220B220D2400200B41186A200F370300200B2005370310200B2004370308200B2003370300200D41606A220D220E2400200B200D1002200D290300220F20065A200D41086A290300220420075A200420075122131B200D41106A290300220520085A200D41186A290300220320095A20032009511B2005200885200320098584501B450D02200E41606A220B2400200C41086A1000200B200C41086A41086A290300370308200B200C290308370300200B200C41086A41106A3502003E02104101450D03200020012002200B290300200B41086A290300200B41106A350200200F20067D200420077D200F200654220BAD7D200520087D2206200B200420075420131BAD22077D200320097D2005200854AD7D2006200754AD7D1014220B450D04200C41206A2400200B0F0B200C41206A2400200D0F0B200C41206A240041000F0B4128410141001011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2213200D410376100B200E41706A220A220E2400200A4120360200200A20134104100F200B280200210A200E41706A220E2400200E200A360200200E200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B200C41206A240041000F0B200A41013A0000200C41206A240041000BA00D04047F047E027F047E2300220A210B02400240024002402000200242FFFFFFFF0F8384200184500D002003200542FFFFFFFF0F83842004844200510D014101450D02200A41406A220A220C2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C290300210E200C41086A290300210F200C41106A2903002110200C41186A2903002111200D41606A220A220C2400200A41186A2011370300200A2010370310200A200F370308200A200E370300200C41606A220C220D2400200A200C1002200C290300221120065A200C41086A290300220E20075A200E20075122121B200C41106A290300220F20085A200C41186A290300221020095A20102009511B200F200885201020098584501B0D034126410141C0021011220C280200413F6A41607141246A220B100D220A41A0F38DC600360200200A41046A2212200B410376100B200D41706A220D22132400200D4120360200200D20124104100F200C280200210D201341706A221224002012200D3602002012200A41246A4104100F200A41C4006A200C41086A200D100A200A200B100341011004000B4125410141E0011011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2212200D410376100B200A41706A220A22132400200A4120360200200A20124104100F200B280200210A201341706A221224002012200A3602002012200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B412341014190021011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2212200D410376100B200A41706A220A22132400200A4120360200200A20124104100F200B280200210A201341706A221224002012200A3602002012200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B200B240041000F0B200D41406A220A220C2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C2903002114200C41086A2903002115200C41106A2903002116200C41186A2903002117200D41606A220A220C2400200A41186A2017370300200A2016370310200A2015370308200A2014370300200C41606A220C220D2400200C41186A201020097D200F200854AD7D200F20087D220F20112006542213200E20075420121BAD221054AD7D370300200C200F20107D370310200C200E20077D2013AD7D370308200C201120067D370300200A200C1005200D41406A220A220C2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C290300210E200C41086A290300210F200C41106A2903002110200C41186A2903002111200D41606A220A220C2400200A41186A2011370300200A2010370310200A200F370308200A200E370300200C41606A220C220D2400200A200C1002200C41186A2903002111200C41106A290300210F200C41086A290300210E200C2903002110200D41406A220A220C2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C2903002114200C41086A2903002115200C41106A2903002116200C41186A2903002117200D41606A220A220C2400200A41186A2017370300200A2016370310200A2015370308200A2014370300200C41606A220C220D2400200C41186A201120097C200F20087C2211200F54AD7C2011201020067C22142010542212200E20077C2012AD7C220F200E54200F200E511BAD7C220E201154AD7C370300200C200E370310200C200F370308200C2014370300200A200C10054120100D220C4104100B200D41606A220A220D2400200A41186A2009370300200A2008370310200A2007370308200A2006370300200A200C4120100F4120100D22124104100B200D41606A220A220D2400200A2001370308200A2000370300200A20023E0210200A20124114100F4120100D22124104100B200D41606A220A2400200A2004370308200A2003370300200A20053E0210200A20124114100F200C41201006200B240041000BD00602067F047E2300220A210B024002402000200242FFFFFFFF0F8384200184500D002003200542FFFFFFFF0F83842004844200520D014122410141B0011011220B280200413F6A41607141246A220C100D220D41A0F38DC600360200200D41046A220E200C410376100B200A41706A220A220F2400200A4120360200200A200E4104100F200B280200210A200F41706A220E2400200E200A360200200E200D41246A4104100F200D41C4006A200B41086A200A100A200D200C100341011004000B412441014180011011220B280200413F6A41607141246A220C100D220D41A0F38DC600360200200D41046A220E200C410376100B200A41706A220A220F2400200A4120360200200A200E4104100F200B280200210A200F41706A220E2400200E200A360200200E200D41246A4104100F200D41C4006A200B41086A200A100A200D200C100341011004000B200A41406A220A220D2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4201370300200D41606A220D220C2400200A4138200D1001200D2903002110200D41086A2903002111200D41106A2903002112200D41186A2903002113200C41406A220A220D2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A2013370300200A2012370310200A2011370308200A2010370300200D41606A220D220C2400200A4138200D1001200D2903002110200D41086A2903002111200D41106A2903002112200D41186A2903002113200C41606A220A220D2400200A41186A2013370300200A2012370310200A2011370308200A2010370300200D41606A220D220C2400200D41186A2009370300200D2008370310200D2007370308200D2006370300200A200D10054120100D220D4104100B200C41606A220A220C2400200A41186A2009370300200A2008370310200A2007370308200A2006370300200A200D4120100F4120100D220E4104100B200C41606A220A220C2400200A2001370308200A2000370300200A20023E0210200A200E4114100F4120100D220E4104100B200C41606A220A2400200A2004370308200A2003370300200A20053E0210200A200E4114100F200D41201006200B240041000BD00605027F037E027F017E017F230041306B220824002008220941186A10002009200941186A41086A290300370308200920092903183703002009200941186A41106A3502003E0210024002400240024041000D00200941106A350200210A200941086A290300210B2009290300210C200841406A2208220D2400200841286A200B370300200841206A200C370300200841306A200A3E0200200841186A4200370300200842003703102008420037030820084201370300200D41606A220D220E240020084138200D1001200D290300210A200D41086A290300210B200D41106A290300210C200D41186A290300210F200E41406A2208220D2400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A200F3703002008200C3703102008200B3703082008200A370300200D41606A220D220E240020084138200D1001200D290300210A200D41086A290300210B200D41106A290300210C200D41186A290300210F200E41606A2208220D2400200841186A200F3703002008200C3703102008200B3703082008200A370300200D41606A220D220E24002008200D1002200D290300220F20035A200D41086A290300220B20045A200B20045122101B200D41106A290300220C20055A200D41186A290300220A20065A200A2006511B200C200585200A20068584501B450D01200E41606A22082400200941186A10002008200941186A41086A290300370308200820092903183703002008200941186A41106A3502003E02104101450D022008290300200841086A290300200841106A350200200020012002200F20037D200B20047D200F2003542208AD7D200C20057D22032008200B20045420101BAD22047D200A20067D200C200554AD7D2003200454AD7D10142208450D03200941306A240020080F0B200941306A240041000F0B41254101413010112208280200413F6A41607141246A220D100D220941A0F38DC600360200200941046A2210200D410376100B200E41706A2207220E240020074120360200200720104104100F20082802002107200E41706A220E2400200E2007360200200E200941246A4104100F200941C4006A200841086A2007100A2009200D100341011004000B200941306A240041000F0B200741013A0000200941306A240041000B990504047F037E017F047E230041306B220824002008220941186A10002009200941186A41086A220A290300370308200920092903183703002009200941186A41106A220B3502003E021002400240024041000D00200941086A290300210C200941106A350200210D2009290300210E200841606A2208220F2400200941186A10002008200A290300370308200820092903183703002008200B3502003E02104101450D01200841106A3502002110200841086A290300211120082903002112200F41406A2208220A2400200841286A2011370300200841206A2012370300200841306A20103E0200200841186A4200370300200842003703102008420037030820084201370300200A41606A220A220B240020084138200A1001200A2903002110200A41086A2903002111200A41106A2903002112200A41186A2903002113200B41406A2208220A2400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A2013370300200820123703102008201137030820082010370300200A41606A220A220B240020084138200A1001200A2903002110200A41086A2903002111200A41106A2903002112200A41186A2903002113200B41606A2208220A2400200841186A2013370300200820123703102008201137030820082010370300200A41606A220A24002008200A1002200E200C200D200020012002200A290300221020037C2211200A41086A290300220320047C20112010542208AD7C2204200A41106A290300221020057C22052008200420035420042003511BAD7C2203200A41186A29030020067C2005201054AD7C2003200554AD7C10142208450D02200941306A240020080F0B200941306A240041000F0B200941306A240041000F0B200741013A0000200941306A240041000BEC0101027F230041E0006B22042400200441406A22052400200541286A2001370300200541206A2000370300200541306A20023E0200200541186A4200370300200542003703102005420037030820054200370300200541382004220441C0006A1001200441206A41186A200441C0006A41186A2903003703002004200441C0006A41106A2903003703302004200441C0006A41086A29030037032820042004290340370320200441206A20041002200341186A200441186A2903003703002003200441106A2903003703102003200441086A29030037030820032004290300370300200441E0006A240041000BCB0802067F087E230022072108024002402000200242FFFFFFFF0F8384200184500D0041010D012008240041000F0B411F410141E00010112208280200413F6A41607141246A2209100D220A41A0F38DC600360200200A41046A220B2009410376100B200741706A2207220C2400200741203602002007200B4104100F20082802002107200C41706A220B2400200B2007360200200B200A41246A4104100F200A41C4006A200841086A2007100A200A2009100341011004000B200741606A2207220A2400200741186A4200370300200742003703102007420037030820074202370300200A41606A220A220924002007200A1002200A41186A290300210D200A41106A290300210E200A41086A290300210F200A2903002110200941606A2207220A2400200741186A4200370300200742003703102007420037030820074202370300200A41606A220A22092400200A41186A200D20067C200E20057C220D200E54AD7C200D201020037C2211201054220B200F20047C200BAD7C220E200F54200E200F511BAD7C220F200D54AD7C370300200A200F370310200A200E370308200A20113703002007200A1005200941406A2207220A2400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200A41606A220A2209240020074138200A1001200A290300210F200A41086A290300210E200A41106A2903002110200A41186A290300210D200941606A2207220A2400200741186A200D370300200720103703102007200E3703082007200F370300200A41606A220A220924002007200A1002200A41186A290300210D200A41106A290300210E200A41086A290300210F200A2903002110200941406A2207220A2400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200A41606A220A2209240020074138200A1001200A2903002111200A41086A2903002112200A41106A2903002113200A41186A2903002114200941606A2207220A2400200741186A2014370300200720133703102007201237030820072011370300200A41606A220A22092400200A41186A200D20067C200E20057C220D200E54AD7C200D201020037C2211201054220B200F20047C200BAD7C220E200F54200E200F511BAD7C220F200D54AD7C370300200A200F370310200A200E370308200A20113703002007200A10054120100D220A4104100B200941606A220722092400200741186A20063703002007200537031020072004370308200720033703002007200A4120100F4120100D220B4104100B200941606A2207220924002007420037030820074200370300200742003E02102007200B4114100F4120100D220B4104100B200941606A220724002007200137030820072000370300200720023E02102007200B4114100F200A412010062008240041000BF30202037F017E23004180016B22072400200741406A220822092400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A4200370300200842003703102008420037030820084201370300200841382007220741E0006A1001200741E0006A41086A2903002102200741E0006A41106A2903002100200741E0006A41186A29030021012007290360210A200941406A22082400200841286A2004370300200841206A2003370300200841306A20053E0200200841186A200137030020082000370310200820023703082008200A37030020084138200741C0006A1001200741206A41186A200741C0006A41186A2903003703002007200741C0006A41106A2903003703302007200741C0006A41086A29030037032820072007290340370320200741206A20071002200641186A200741186A2903003703002006200741106A2903003703102006200741086A2903003703082006200729030037030020074180016A240041000BFB0904047F047E027F047E2300220721080240024002402000200242FFFFFFFF0F8384200184500D004101450D01200741406A220722092400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200941606A2209220A240020074138200910012009290300210B200941086A290300210C200941106A290300210D200941186A290300210E200A41606A220722092400200741186A200E3703002007200D3703102007200C3703082007200B370300200941606A2209220A24002007200910022009290300220E20035A200941086A290300220B20045A200B200451220F1B200941106A290300220C20055A200941186A290300220D20065A200D2006511B200C200585200D20068584501B0D024122410141A00310112209280200413F6A41607141246A2208100D220741A0F38DC600360200200741046A220F2008410376100B200A41706A220A22102400200A4120360200200A200F4104100F2009280200210A201041706A220F2400200F200A360200200F200741246A4104100F200741C4006A200941086A200A100A20072008100341011004000B4121410141F00210112208280200413F6A41607141246A220A100D220941A0F38DC600360200200941046A220F200A410376100B200741706A220722102400200741203602002007200F4104100F20082802002107201041706A220F2400200F2007360200200F200941246A4104100F200941C4006A200841086A2007100A2009200A100341011004000B2008240041000F0B200A41406A220722092400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200941606A2209220A2400200741382009100120092903002111200941086A2903002112200941106A2903002113200941186A2903002114200A41606A220722092400200741186A2014370300200720133703102007201237030820072011370300200941606A2209220A2400200941186A200D20067D200C200554AD7D200C20057D220C200E2003542210200B200454200F1BAD220D54AD7D3703002009200C200D7D3703102009200B20047D2010AD7D3703082009200E20037D370300200720091005200A41606A220722092400200741186A4200370300200742003703102007420037030820074202370300200941606A2209220A2400200720091002200941186A290300210E200941106A290300210C2009290300210D200941086A290300210B200A41606A220722092400200741186A4200370300200742003703102007420037030820074202370300200941606A2209220A2400200941186A200E20067D200C200554AD7D200C20057D220C200D200354220F200B200454200B2004511BAD220E54AD7D3703002009200C200E7D3703102009200B20047D200FAD7D3703082009200D20037D3703002007200910054120100D22094104100B200A41606A2207220A2400200741186A2006370300200720053703102007200437030820072003370300200720094120100F4120100D220F4104100B200A41606A2207220A24002007200137030820072000370300200720023E02102007200F4114100F4120100D220F4104100B200A41606A220724002007420037030820074200370300200742003E02102007200F4114100F2009412010062008240041000BCC1602047F0A7E23004190066B22002400200010070240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002402000290300200041086A290300844200520D00100C4100100822013602C80341002001100D22023602CC0341002001200210090240024002400240024002400240024002400240024002400240200141034D0D004100200228020022033602C4032001417C6A2101200241046A2102024020034185FAFB1E4A0D000240200341A3AF89BE7D4A0D002003419D85FFE47A460D0620034189BC9D9D7B460D0D200341A98BF0DC7B470D0220014120490D242002200041E0036A4118100E2001AD423F580D09200041E0036A41106A3502002104200041E0036A41086A290300210520002903E0032106200241206A200041F8036A4120100E200041F8036A41186A2903002107200041F8036A41106A2903002108200041F8036A41086A290300210920002903F803210A200041F0056A10002000200041F0056A41086A290300220B3703D805200020002903F005220C3703D0052000200041F0056A41106A350200220D3E02E005200C200B200D200620052004200A200920082007101322010D0A200041013A009E0441000D0B0C2C0B200341A4AF89BE7D460D04200341A3F0CAEB7D460D0320034198ACB4E87D470D01200041F0056A41186A42003703002000420037038006200042003703F805200042023703F005200041F0056A200041D0056A1002200041B0056A41186A200041D0056A41186A2903003703002000200041E0056A2903003703C0052000200041D8056A2903003703B805200020002903D0053703B0054100450D2941004100100341011004000B0240200341DCC5B5F7034A0D00200341C082BFC801460D02200341F0C08A8C03460D0720034186FAFB1E470D01200041C0026A4280DC95DBF68DDDA0CC00370300200042003703B802200042003703B002200042003703A8024100450D1C41004100100341011004000B0240200341B8A0CD8C054A0D00200341DDC5B5F703460D0D20034195B1EF8C04470D01200041D8036A42808080808080C0A0CC00370300200042003703D003200042003703C803200042003703C0034100450D2241004100100341011004000B200341B9A0CD8C05460D05200341B1F894BF06460D0A0B41004100100341011004000B20014120490D0C2002200041106A4118100E2001AD423F580D0D200041106A41106A3502002104200041106A41086A290300210520002903102106200241206A200041286A4120100E02402006200520042000290328200041286A41086A290300200041286A41106A290300200041286A41186A290300101822010D00200041013A004F410021010B2001450D0E41004100100341011004000B20014120490D0E2002200041D0006A4118100E2001AD2204423F580D0F200041D0006A41106A3502002105200041D0006A41086A290300210620002903502107200241206A200041E8006A4118100E200442DF00580D10200041E8006A41106A3502002104200041E8006A41086A290300210820002903682109200241C0006A20004180016A4120100E20072006200520092008200420002903800120004188016A29030020004190016A29030020004198016A290300200041A7016A1012450D1141004100100341011004000B20014120490D112002200041A8016A4118100E2001AD423F580D12200041A8016A41106A3502002104200041A8016A41086A290300210520002903A8012106200241206A200041C0016A4120100E20062005200420002903C001200041C0016A41086A290300200041C0016A41106A290300200041C0016A41186A290300200041E7016A1015450D1341004100100341011004000B20014120490D132002200041E8016A4118100E2001AD423F580D14200041E8016A41106A3502002104200041E8016A41086A290300210520002903E8012106200241206A20004180026A4120100E024020062005200420002903800220004180026A41086A29030020004180026A41106A29030020004180026A41186A290300101A22010D00200041013A00A702410021010B2001450D1541004100100341011004000B20014120490D162002200041C8026A4118100E2001AD423F580D17200041C8026A41106A3502002104200041C8026A41086A290300210520002903C8022106200241206A200041E0026A4120100E20062005200420002903E002200041E0026A41086A290300200041E0026A41106A290300200041E0026A41186A29030020004187036A1016450D1841004100100341011004000B20014120490D18200220004188036A4118100E20002903880320004190036A29030020004198036A350200200041A0036A1017450D1941004100100341011004000B20004190066A240041030F0B2001450D210B41004100100341011004000B200041123A009F044100450D1841004100100341011004000B20014120490D182002200041A0046A4118100E0240024002402001AD423F580D00200041A0046A41106A3502002104200041A0046A41086A290300210520002903A0042106200241206A200041B8046A4120100E200041B8046A41186A2903002107200041B8046A41106A2903002108200041B8046A41086A290300210920002903B804210A200041F0056A10002000200041F0056A41086A290300220B3703D805200020002903F005220C3703D0052000200041F0056A41106A350200220D3E02E005200C200B200D200620052004200A200920082007101422010D01200041013A00DF0441000D020C200B20004190066A240041030F0B2001450D1E0B41004100100341011004000B20014120490D182002200041E0046A4118100E2001AD423F580D19200041E0046A41106A3502002104200041E0046A41086A290300210520002903E0042106200241206A200041F8046A4118100E20062005200420002903F804200041F8046A41086A290300200041F8046A41106A35020020004190056A1019450D1A41004100100341011004000B41004100100341011004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D004F3A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00A7013A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00E7013A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00A7023A000020014120100341001004000B4120100D22014104100B200041A8026A20014120101020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D0087033A000020014120100341001004000B20004190066A240041030F0B4120100D22014104100B200041A0036A20014120100F20014120100341001004000B4120100D22014104100B200041C0036A20014120101020014120100341001004000B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D009F043A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B20004190056A20014120100F20014120100341001004000B4120100D22014104100B200041B0056A20014120100F20014120100341001004000B4120100D22014104100B2001411F6A20002D00DF043A000020014120100341001004000B4120100D22014104100B2001411F6A20002D009E043A000020014120100341001004000B0BC903010041000BC20345524332303A207472616E7366657220616D6F756E74206578636565647320616C6C6F77616E6365000000000000000045524332303A2064656372656173656420616C6C6F77616E63652062656C6F77207A65726F000000000000000000000045524332303A206D696E7420746F20746865207A65726F20616464726573730045524332303A20617070726F76652066726F6D20746865207A65726F206164647265737300000000000000000000000045524332303A20617070726F766520746F20746865207A65726F2061646472657373000000000000000000000000000045524332303A207472616E736665722066726F6D20746865207A65726F2061646472657373000000000000000000000045524332303A207472616E7366657220746F20746865207A65726F20616464726573730000000000000000000000000045524332303A207472616E7366657220616D6F756E7420657863656564732062616C616E63650000000000000000000045524332303A206275726E2066726F6D20746865207A65726F206164647265737300000000000000000000000000000045524332303A206275726E20616D6F756E7420657863656564732062616C616E636500740970726F647563657273010C70726F6365737365642D62790105636C616E675431302E302E3120286769743A2F2F6769746875622E636F6D2F6C6C766D2F6C6C766D2D70726F6A65637420623661313733343336373838653638333239636335653965653066363531623630336136333765332900DE05046E616D6501D6051C000A6765745F73656E646572011063727970746F5F6B656363616B323536020C6C6F61645F73746F72616765030A7365745F72657475726E040B73797374656D5F68616C74050C736176655F73746F72616765060977726974655F6C6F6707156765745F7472616E736665727265645F66756E6473080D6765745F63616C6C5F73697A65090F636F70795F63616C6C5F76616C75650A085F5F6D656D6370790B085F5F627A65726F380C0B5F5F696E69745F686561700D085F5F6D616C6C6F630E0B5F5F62653332746F6C654E0F0B5F5F6C654E746F62653332100A5F5F6C654E746F62654E110A766563746F725F6E6577123B736F6C3A3A66756E6374696F6E3A3A45524332303A3A7472616E7366657246726F6D5F5F616464726573735F616464726573735F75696E743235361338736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F7472616E736665725F5F616464726573735F616464726573735F75696E743235361437736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F617070726F76655F5F616464726573735F616464726573735F75696E743235361538736F6C3A3A66756E6374696F6E3A3A45524332303A3A6465637265617365416C6C6F77616E63655F5F616464726573735F75696E743235361638736F6C3A3A66756E6374696F6E3A3A45524332303A3A696E637265617365416C6C6F77616E63655F5F616464726573735F75696E743235361728736F6C3A3A66756E6374696F6E3A3A45524332303A3A62616C616E63654F665F5F61646472657373182C736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F6D696E745F5F616464726573735F75696E743235361930736F6C3A3A66756E6374696F6E3A3A45524332303A3A616C6C6F77616E63655F5F616464726573735F616464726573731A2C736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F6275726E5F5F616464726573735F75696E743235361B057374617274"
                    .HexToBytes()
            );
            if (!VirtualMachine.VerifyContract(contract.ByteCode))
                throw new Exception("Unable to validate smart-contract code");

            var snapshot = stateManager.NewSnapshot();
            snapshot.Contracts.AddContract(UInt160Utils.Zero, contract);
            stateManager.Approve();

            Console.WriteLine("Contract Hash: " + hash.ToHex());

            for (var i = 0; i < 1; ++i)
            {
                var currentTime = TimeUtils.CurrentTimeMillis();
                var currentSnapshot = stateManager.NewSnapshot();

                var sender = "0x6bc32575acb8754886dc283c2c8ac54b1bd93195".HexToBytes().ToUInt160();
                var to = "0xfd893ce89186fc6861d339cb6ab5d75458e3daf3".HexToBytes().ToUInt160();

                var transactionReceipt = new TransactionReceipt();
                transactionReceipt.Transaction = new Transaction();
                transactionReceipt.Transaction.Value = 0.ToUInt256();
                var context = new InvocationContext(sender, currentSnapshot, transactionReceipt);

                {
                    /* ERC-20: name */
                    Console.WriteLine("\nERC-20: name()");
                    var input = ContractEncoder.Encode("name()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {"LAtoken"}, {status.ReturnValue!.ToHex()}");
                }

                stateManager.Approve();
            exit_mark:
                var elapsedTime = TimeUtils.CurrentTimeMillis() - currentTime;
                Console.WriteLine("Elapsed Time: " + elapsedTime + "ms");
            }
        }

        [Test]
        public void Test_VirtualMachine_InvokeERC20Contract()
        {
            var stateManager = _container.Resolve<IStateManager>();

            var hash = UInt160Utils.Zero;
            var contract = new Contract
            (
                hash,
                "0061736D01000000016A0D60017F0060037F7F7F0060027F7F006000017F60000060017F017F60037F7F7F017F600B7E7E7E7E7E7E7E7E7E7E7F017F600A7E7E7E7E7E7E7E7E7E7E017F60087E7E7E7E7E7E7E7F017F60047E7E7E7F017F60077E7E7E7E7E7E7E017F60077E7E7E7E7E7E7F017F02C8010A03656E760A6765745F73656E646572000003656E761063727970746F5F6B656363616B323536000103656E760C6C6F61645F73746F72616765000203656E760A7365745F72657475726E000203656E760B73797374656D5F68616C74000003656E760C736176655F73746F72616765000203656E760977726974655F6C6F67000203656E76156765745F7472616E736665727265645F66756E6473000003656E760D6765745F63616C6C5F73697A65000303656E760F636F70795F63616C6C5F76616C75650001031312010204050101010607080809090A0B0C0B040405017001010105030100020608017F01418080040B071202066D656D6F72790200057374617274001B0A8859122E0002402002450D000340200020012D00003A0000200041016A2100200141016A21012002417F6A22020D000B0B0B1C00034020004200370300200041086A21002001417F6A22010D000B0B2E004100410036028080044100410036028480044100410036028C800441003F0041107441F0FF7B6A36028880040BA60101047F418080042101024003400240200128020C0D002001280208220220004F0D020B200128020022010D000B41002101410028020821020B02402002200041076A41787122036B22024118490D00200120036A41106A22002001280200220436020002402004450D00200420003602040B2000200241706A3602082000410036020C2000200136020420012000360200200120033602080B2001410136020C200141106A0B2D002000411F6A21000340200120002D00003A0000200141016A21012000417F6A21002002417F6A22020D000B0B2D002001411F6A21010340200120002D00003A00002001417F6A2101200041016A21002002417F6A22020D000B0B29002001417F6A21010340200120026A20002D00003A0000200041016A21002002417F6A22020D000B0B7E01017F200120006C220141086A100D2203200036020420032000360200200341086A2100024002402002417F460D002001450D010340200020022D00003A0000200041016A2100200241016A21022001417F6A22010D000C020B0B2001450D000340200041003A0000200041016A21002001417F6A22010D000B0B20030B810703047F047E017F230041206B220B210C200B24000240024002400240024020002001200220032004200520062007200820091013220D0D00200B41606A220B220D2400200C41086A1000200B200C41086A41086A290300370308200B200C290308370300200B200C41086A41106A3502003E02104101450D01200B41106A3502002103200B41086A2903002104200B2903002105200D41406A220B220D2400200B41286A2001370300200B41206A2000370300200B41306A20023E0200200B41186A4200370300200B4200370310200B4200370308200B4201370300200D41606A220D220E2400200B4138200D1001200D290300210F200D41086A2903002110200D41106A2903002111200D41186A2903002112200E41406A220B220D2400200B41286A2004370300200B41206A2005370300200B41306A20033E0200200B41186A2012370300200B2011370310200B2010370308200B200F370300200D41606A220D220E2400200B4138200D1001200D2903002103200D41086A2903002104200D41106A2903002105200D41186A290300210F200E41606A220B220D2400200B41186A200F370300200B2005370310200B2004370308200B2003370300200D41606A220D220E2400200B200D1002200D290300220F20065A200D41086A290300220420075A200420075122131B200D41106A290300220520085A200D41186A290300220320095A20032009511B2005200885200320098584501B450D02200E41606A220B2400200C41086A1000200B200C41086A41086A290300370308200B200C290308370300200B200C41086A41106A3502003E02104101450D03200020012002200B290300200B41086A290300200B41106A350200200F20067D200420077D200F200654220BAD7D200520087D2206200B200420075420131BAD22077D200320097D2005200854AD7D2006200754AD7D1014220B450D04200C41206A2400200B0F0B200C41206A2400200D0F0B200C41206A240041000F0B4128410141001011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2213200D410376100B200E41706A220A220E2400200A4120360200200A20134104100F200B280200210A200E41706A220E2400200E200A360200200E200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B200C41206A240041000F0B200A41013A0000200C41206A240041000BA00D04047F047E027F047E2300220A210B02400240024002402000200242FFFFFFFF0F8384200184500D002003200542FFFFFFFF0F83842004844200510D014101450D02200A41406A220A220C2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C290300210E200C41086A290300210F200C41106A2903002110200C41186A2903002111200D41606A220A220C2400200A41186A2011370300200A2010370310200A200F370308200A200E370300200C41606A220C220D2400200A200C1002200C290300221120065A200C41086A290300220E20075A200E20075122121B200C41106A290300220F20085A200C41186A290300221020095A20102009511B200F200885201020098584501B0D034126410141C0021011220C280200413F6A41607141246A220B100D220A41A0F38DC600360200200A41046A2212200B410376100B200D41706A220D22132400200D4120360200200D20124104100F200C280200210D201341706A221224002012200D3602002012200A41246A4104100F200A41C4006A200C41086A200D100A200A200B100341011004000B4125410141E0011011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2212200D410376100B200A41706A220A22132400200A4120360200200A20124104100F200B280200210A201341706A221224002012200A3602002012200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B412341014190021011220B280200413F6A41607141246A220D100D220C41A0F38DC600360200200C41046A2212200D410376100B200A41706A220A22132400200A4120360200200A20124104100F200B280200210A201341706A221224002012200A3602002012200C41246A4104100F200C41C4006A200B41086A200A100A200C200D100341011004000B200B240041000F0B200D41406A220A220C2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C2903002114200C41086A2903002115200C41106A2903002116200C41186A2903002117200D41606A220A220C2400200A41186A2017370300200A2016370310200A2015370308200A2014370300200C41606A220C220D2400200C41186A201020097D200F200854AD7D200F20087D220F20112006542213200E20075420121BAD221054AD7D370300200C200F20107D370310200C200E20077D2013AD7D370308200C201120067D370300200A200C1005200D41406A220A220C2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C290300210E200C41086A290300210F200C41106A2903002110200C41186A2903002111200D41606A220A220C2400200A41186A2011370300200A2010370310200A200F370308200A200E370300200C41606A220C220D2400200A200C1002200C41186A2903002111200C41106A290300210F200C41086A290300210E200C2903002110200D41406A220A220C2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A4200370300200A4200370310200A4200370308200A4200370300200C41606A220C220D2400200A4138200C1001200C2903002114200C41086A2903002115200C41106A2903002116200C41186A2903002117200D41606A220A220C2400200A41186A2017370300200A2016370310200A2015370308200A2014370300200C41606A220C220D2400200C41186A201120097C200F20087C2211200F54AD7C2011201020067C22142010542212200E20077C2012AD7C220F200E54200F200E511BAD7C220E201154AD7C370300200C200E370310200C200F370308200C2014370300200A200C10054120100D220C4104100B200D41606A220A220D2400200A41186A2009370300200A2008370310200A2007370308200A2006370300200A200C4120100F4120100D22124104100B200D41606A220A220D2400200A2001370308200A2000370300200A20023E0210200A20124114100F4120100D22124104100B200D41606A220A2400200A2004370308200A2003370300200A20053E0210200A20124114100F200C41201006200B240041000BD00602067F047E2300220A210B024002402000200242FFFFFFFF0F8384200184500D002003200542FFFFFFFF0F83842004844200520D014122410141B0011011220B280200413F6A41607141246A220C100D220D41A0F38DC600360200200D41046A220E200C410376100B200A41706A220A220F2400200A4120360200200A200E4104100F200B280200210A200F41706A220E2400200E200A360200200E200D41246A4104100F200D41C4006A200B41086A200A100A200D200C100341011004000B412441014180011011220B280200413F6A41607141246A220C100D220D41A0F38DC600360200200D41046A220E200C410376100B200A41706A220A220F2400200A4120360200200A200E4104100F200B280200210A200F41706A220E2400200E200A360200200E200D41246A4104100F200D41C4006A200B41086A200A100A200D200C100341011004000B200A41406A220A220D2400200A41286A2001370300200A41206A2000370300200A41306A20023E0200200A41186A4200370300200A4200370310200A4200370308200A4201370300200D41606A220D220C2400200A4138200D1001200D2903002110200D41086A2903002111200D41106A2903002112200D41186A2903002113200C41406A220A220D2400200A41286A2004370300200A41206A2003370300200A41306A20053E0200200A41186A2013370300200A2012370310200A2011370308200A2010370300200D41606A220D220C2400200A4138200D1001200D2903002110200D41086A2903002111200D41106A2903002112200D41186A2903002113200C41606A220A220D2400200A41186A2013370300200A2012370310200A2011370308200A2010370300200D41606A220D220C2400200D41186A2009370300200D2008370310200D2007370308200D2006370300200A200D10054120100D220D4104100B200C41606A220A220C2400200A41186A2009370300200A2008370310200A2007370308200A2006370300200A200D4120100F4120100D220E4104100B200C41606A220A220C2400200A2001370308200A2000370300200A20023E0210200A200E4114100F4120100D220E4104100B200C41606A220A2400200A2004370308200A2003370300200A20053E0210200A200E4114100F200D41201006200B240041000BD00605027F037E027F017E017F230041306B220824002008220941186A10002009200941186A41086A290300370308200920092903183703002009200941186A41106A3502003E0210024002400240024041000D00200941106A350200210A200941086A290300210B2009290300210C200841406A2208220D2400200841286A200B370300200841206A200C370300200841306A200A3E0200200841186A4200370300200842003703102008420037030820084201370300200D41606A220D220E240020084138200D1001200D290300210A200D41086A290300210B200D41106A290300210C200D41186A290300210F200E41406A2208220D2400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A200F3703002008200C3703102008200B3703082008200A370300200D41606A220D220E240020084138200D1001200D290300210A200D41086A290300210B200D41106A290300210C200D41186A290300210F200E41606A2208220D2400200841186A200F3703002008200C3703102008200B3703082008200A370300200D41606A220D220E24002008200D1002200D290300220F20035A200D41086A290300220B20045A200B20045122101B200D41106A290300220C20055A200D41186A290300220A20065A200A2006511B200C200585200A20068584501B450D01200E41606A22082400200941186A10002008200941186A41086A290300370308200820092903183703002008200941186A41106A3502003E02104101450D022008290300200841086A290300200841106A350200200020012002200F20037D200B20047D200F2003542208AD7D200C20057D22032008200B20045420101BAD22047D200A20067D200C200554AD7D2003200454AD7D10142208450D03200941306A240020080F0B200941306A240041000F0B41254101413010112208280200413F6A41607141246A220D100D220941A0F38DC600360200200941046A2210200D410376100B200E41706A2207220E240020074120360200200720104104100F20082802002107200E41706A220E2400200E2007360200200E200941246A4104100F200941C4006A200841086A2007100A2009200D100341011004000B200941306A240041000F0B200741013A0000200941306A240041000B990504047F037E017F047E230041306B220824002008220941186A10002009200941186A41086A220A290300370308200920092903183703002009200941186A41106A220B3502003E021002400240024041000D00200941086A290300210C200941106A350200210D2009290300210E200841606A2208220F2400200941186A10002008200A290300370308200820092903183703002008200B3502003E02104101450D01200841106A3502002110200841086A290300211120082903002112200F41406A2208220A2400200841286A2011370300200841206A2012370300200841306A20103E0200200841186A4200370300200842003703102008420037030820084201370300200A41606A220A220B240020084138200A1001200A2903002110200A41086A2903002111200A41106A2903002112200A41186A2903002113200B41406A2208220A2400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A2013370300200820123703102008201137030820082010370300200A41606A220A220B240020084138200A1001200A2903002110200A41086A2903002111200A41106A2903002112200A41186A2903002113200B41606A2208220A2400200841186A2013370300200820123703102008201137030820082010370300200A41606A220A24002008200A1002200E200C200D200020012002200A290300221020037C2211200A41086A290300220320047C20112010542208AD7C2204200A41106A290300221020057C22052008200420035420042003511BAD7C2203200A41186A29030020067C2005201054AD7C2003200554AD7C10142208450D02200941306A240020080F0B200941306A240041000F0B200941306A240041000F0B200741013A0000200941306A240041000BEC0101027F230041E0006B22042400200441406A22052400200541286A2001370300200541206A2000370300200541306A20023E0200200541186A4200370300200542003703102005420037030820054200370300200541382004220441C0006A1001200441206A41186A200441C0006A41186A2903003703002004200441C0006A41106A2903003703302004200441C0006A41086A29030037032820042004290340370320200441206A20041002200341186A200441186A2903003703002003200441106A2903003703102003200441086A29030037030820032004290300370300200441E0006A240041000BCB0802067F087E230022072108024002402000200242FFFFFFFF0F8384200184500D0041010D012008240041000F0B411F410141E00010112208280200413F6A41607141246A2209100D220A41A0F38DC600360200200A41046A220B2009410376100B200741706A2207220C2400200741203602002007200B4104100F20082802002107200C41706A220B2400200B2007360200200B200A41246A4104100F200A41C4006A200841086A2007100A200A2009100341011004000B200741606A2207220A2400200741186A4200370300200742003703102007420037030820074202370300200A41606A220A220924002007200A1002200A41186A290300210D200A41106A290300210E200A41086A290300210F200A2903002110200941606A2207220A2400200741186A4200370300200742003703102007420037030820074202370300200A41606A220A22092400200A41186A200D20067C200E20057C220D200E54AD7C200D201020037C2211201054220B200F20047C200BAD7C220E200F54200E200F511BAD7C220F200D54AD7C370300200A200F370310200A200E370308200A20113703002007200A1005200941406A2207220A2400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200A41606A220A2209240020074138200A1001200A290300210F200A41086A290300210E200A41106A2903002110200A41186A290300210D200941606A2207220A2400200741186A200D370300200720103703102007200E3703082007200F370300200A41606A220A220924002007200A1002200A41186A290300210D200A41106A290300210E200A41086A290300210F200A2903002110200941406A2207220A2400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200A41606A220A2209240020074138200A1001200A2903002111200A41086A2903002112200A41106A2903002113200A41186A2903002114200941606A2207220A2400200741186A2014370300200720133703102007201237030820072011370300200A41606A220A22092400200A41186A200D20067C200E20057C220D200E54AD7C200D201020037C2211201054220B200F20047C200BAD7C220E200F54200E200F511BAD7C220F200D54AD7C370300200A200F370310200A200E370308200A20113703002007200A10054120100D220A4104100B200941606A220722092400200741186A20063703002007200537031020072004370308200720033703002007200A4120100F4120100D220B4104100B200941606A2207220924002007420037030820074200370300200742003E02102007200B4114100F4120100D220B4104100B200941606A220724002007200137030820072000370300200720023E02102007200B4114100F200A412010062008240041000BF30202037F017E23004180016B22072400200741406A220822092400200841286A2001370300200841206A2000370300200841306A20023E0200200841186A4200370300200842003703102008420037030820084201370300200841382007220741E0006A1001200741E0006A41086A2903002102200741E0006A41106A2903002100200741E0006A41186A29030021012007290360210A200941406A22082400200841286A2004370300200841206A2003370300200841306A20053E0200200841186A200137030020082000370310200820023703082008200A37030020084138200741C0006A1001200741206A41186A200741C0006A41186A2903003703002007200741C0006A41106A2903003703302007200741C0006A41086A29030037032820072007290340370320200741206A20071002200641186A200741186A2903003703002006200741106A2903003703102006200741086A2903003703082006200729030037030020074180016A240041000BFB0904047F047E027F047E2300220721080240024002402000200242FFFFFFFF0F8384200184500D004101450D01200741406A220722092400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200941606A2209220A240020074138200910012009290300210B200941086A290300210C200941106A290300210D200941186A290300210E200A41606A220722092400200741186A200E3703002007200D3703102007200C3703082007200B370300200941606A2209220A24002007200910022009290300220E20035A200941086A290300220B20045A200B200451220F1B200941106A290300220C20055A200941186A290300220D20065A200D2006511B200C200585200D20068584501B0D024122410141A00310112209280200413F6A41607141246A2208100D220741A0F38DC600360200200741046A220F2008410376100B200A41706A220A22102400200A4120360200200A200F4104100F2009280200210A201041706A220F2400200F200A360200200F200741246A4104100F200741C4006A200941086A200A100A20072008100341011004000B4121410141F00210112208280200413F6A41607141246A220A100D220941A0F38DC600360200200941046A220F200A410376100B200741706A220722102400200741203602002007200F4104100F20082802002107201041706A220F2400200F2007360200200F200941246A4104100F200941C4006A200841086A2007100A2009200A100341011004000B2008240041000F0B200A41406A220722092400200741286A2001370300200741206A2000370300200741306A20023E0200200741186A4200370300200742003703102007420037030820074200370300200941606A2209220A2400200741382009100120092903002111200941086A2903002112200941106A2903002113200941186A2903002114200A41606A220722092400200741186A2014370300200720133703102007201237030820072011370300200941606A2209220A2400200941186A200D20067D200C200554AD7D200C20057D220C200E2003542210200B200454200F1BAD220D54AD7D3703002009200C200D7D3703102009200B20047D2010AD7D3703082009200E20037D370300200720091005200A41606A220722092400200741186A4200370300200742003703102007420037030820074202370300200941606A2209220A2400200720091002200941186A290300210E200941106A290300210C2009290300210D200941086A290300210B200A41606A220722092400200741186A4200370300200742003703102007420037030820074202370300200941606A2209220A2400200941186A200E20067D200C200554AD7D200C20057D220C200D200354220F200B200454200B2004511BAD220E54AD7D3703002009200C200E7D3703102009200B20047D200FAD7D3703082009200D20037D3703002007200910054120100D22094104100B200A41606A2207220A2400200741186A2006370300200720053703102007200437030820072003370300200720094120100F4120100D220F4104100B200A41606A2207220A24002007200137030820072000370300200720023E02102007200F4114100F4120100D220F4104100B200A41606A220724002007420037030820074200370300200742003E02102007200F4114100F2009412010062008240041000BCC1602047F0A7E23004190066B22002400200010070240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002402000290300200041086A290300844200520D00100C4100100822013602C80341002001100D22023602CC0341002001200210090240024002400240024002400240024002400240024002400240200141034D0D004100200228020022033602C4032001417C6A2101200241046A2102024020034185FAFB1E4A0D000240200341A3AF89BE7D4A0D002003419D85FFE47A460D0620034189BC9D9D7B460D0D200341A98BF0DC7B470D0220014120490D242002200041E0036A4118100E2001AD423F580D09200041E0036A41106A3502002104200041E0036A41086A290300210520002903E0032106200241206A200041F8036A4120100E200041F8036A41186A2903002107200041F8036A41106A2903002108200041F8036A41086A290300210920002903F803210A200041F0056A10002000200041F0056A41086A290300220B3703D805200020002903F005220C3703D0052000200041F0056A41106A350200220D3E02E005200C200B200D200620052004200A200920082007101322010D0A200041013A009E0441000D0B0C2C0B200341A4AF89BE7D460D04200341A3F0CAEB7D460D0320034198ACB4E87D470D01200041F0056A41186A42003703002000420037038006200042003703F805200042023703F005200041F0056A200041D0056A1002200041B0056A41186A200041D0056A41186A2903003703002000200041E0056A2903003703C0052000200041D8056A2903003703B805200020002903D0053703B0054100450D2941004100100341011004000B0240200341DCC5B5F7034A0D00200341C082BFC801460D02200341F0C08A8C03460D0720034186FAFB1E470D01200041C0026A4280DC95DBF68DDDA0CC00370300200042003703B802200042003703B002200042003703A8024100450D1C41004100100341011004000B0240200341B8A0CD8C054A0D00200341DDC5B5F703460D0D20034195B1EF8C04470D01200041D8036A42808080808080C0A0CC00370300200042003703D003200042003703C803200042003703C0034100450D2241004100100341011004000B200341B9A0CD8C05460D05200341B1F894BF06460D0A0B41004100100341011004000B20014120490D0C2002200041106A4118100E2001AD423F580D0D200041106A41106A3502002104200041106A41086A290300210520002903102106200241206A200041286A4120100E02402006200520042000290328200041286A41086A290300200041286A41106A290300200041286A41186A290300101822010D00200041013A004F410021010B2001450D0E41004100100341011004000B20014120490D0E2002200041D0006A4118100E2001AD2204423F580D0F200041D0006A41106A3502002105200041D0006A41086A290300210620002903502107200241206A200041E8006A4118100E200442DF00580D10200041E8006A41106A3502002104200041E8006A41086A290300210820002903682109200241C0006A20004180016A4120100E20072006200520092008200420002903800120004188016A29030020004190016A29030020004198016A290300200041A7016A1012450D1141004100100341011004000B20014120490D112002200041A8016A4118100E2001AD423F580D12200041A8016A41106A3502002104200041A8016A41086A290300210520002903A8012106200241206A200041C0016A4120100E20062005200420002903C001200041C0016A41086A290300200041C0016A41106A290300200041C0016A41186A290300200041E7016A1015450D1341004100100341011004000B20014120490D132002200041E8016A4118100E2001AD423F580D14200041E8016A41106A3502002104200041E8016A41086A290300210520002903E8012106200241206A20004180026A4120100E024020062005200420002903800220004180026A41086A29030020004180026A41106A29030020004180026A41186A290300101A22010D00200041013A00A702410021010B2001450D1541004100100341011004000B20014120490D162002200041C8026A4118100E2001AD423F580D17200041C8026A41106A3502002104200041C8026A41086A290300210520002903C8022106200241206A200041E0026A4120100E20062005200420002903E002200041E0026A41086A290300200041E0026A41106A290300200041E0026A41186A29030020004187036A1016450D1841004100100341011004000B20014120490D18200220004188036A4118100E20002903880320004190036A29030020004198036A350200200041A0036A1017450D1941004100100341011004000B20004190066A240041030F0B2001450D210B41004100100341011004000B200041123A009F044100450D1841004100100341011004000B20014120490D182002200041A0046A4118100E0240024002402001AD423F580D00200041A0046A41106A3502002104200041A0046A41086A290300210520002903A0042106200241206A200041B8046A4120100E200041B8046A41186A2903002107200041B8046A41106A2903002108200041B8046A41086A290300210920002903B804210A200041F0056A10002000200041F0056A41086A290300220B3703D805200020002903F005220C3703D0052000200041F0056A41106A350200220D3E02E005200C200B200D200620052004200A200920082007101422010D01200041013A00DF0441000D020C200B20004190066A240041030F0B2001450D1E0B41004100100341011004000B20014120490D182002200041E0046A4118100E2001AD423F580D19200041E0046A41106A3502002104200041E0046A41086A290300210520002903E0042106200241206A200041F8046A4118100E20062005200420002903F804200041F8046A41086A290300200041F8046A41106A35020020004190056A1019450D1A41004100100341011004000B41004100100341011004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D004F3A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00A7013A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00E7013A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D00A7023A000020014120100341001004000B4120100D22014104100B200041A8026A20014120101020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D0087033A000020014120100341001004000B20004190066A240041030F0B4120100D22014104100B200041A0036A20014120100F20014120100341001004000B4120100D22014104100B200041C0036A20014120101020014120100341001004000B20004190066A240041030F0B4120100D22014104100B2001411F6A20002D009F043A000020014120100341001004000B20004190066A240041030F0B20004190066A240041030F0B20004190066A240041030F0B4120100D22014104100B20004190056A20014120100F20014120100341001004000B4120100D22014104100B200041B0056A20014120100F20014120100341001004000B4120100D22014104100B2001411F6A20002D00DF043A000020014120100341001004000B4120100D22014104100B2001411F6A20002D009E043A000020014120100341001004000B0BC903010041000BC20345524332303A207472616E7366657220616D6F756E74206578636565647320616C6C6F77616E6365000000000000000045524332303A2064656372656173656420616C6C6F77616E63652062656C6F77207A65726F000000000000000000000045524332303A206D696E7420746F20746865207A65726F20616464726573730045524332303A20617070726F76652066726F6D20746865207A65726F206164647265737300000000000000000000000045524332303A20617070726F766520746F20746865207A65726F2061646472657373000000000000000000000000000045524332303A207472616E736665722066726F6D20746865207A65726F2061646472657373000000000000000000000045524332303A207472616E7366657220746F20746865207A65726F20616464726573730000000000000000000000000045524332303A207472616E7366657220616D6F756E7420657863656564732062616C616E63650000000000000000000045524332303A206275726E2066726F6D20746865207A65726F206164647265737300000000000000000000000000000045524332303A206275726E20616D6F756E7420657863656564732062616C616E636500740970726F647563657273010C70726F6365737365642D62790105636C616E675431302E302E3120286769743A2F2F6769746875622E636F6D2F6C6C766D2F6C6C766D2D70726F6A65637420623661313733343336373838653638333239636335653965653066363531623630336136333765332900DE05046E616D6501D6051C000A6765745F73656E646572011063727970746F5F6B656363616B323536020C6C6F61645F73746F72616765030A7365745F72657475726E040B73797374656D5F68616C74050C736176655F73746F72616765060977726974655F6C6F6707156765745F7472616E736665727265645F66756E6473080D6765745F63616C6C5F73697A65090F636F70795F63616C6C5F76616C75650A085F5F6D656D6370790B085F5F627A65726F380C0B5F5F696E69745F686561700D085F5F6D616C6C6F630E0B5F5F62653332746F6C654E0F0B5F5F6C654E746F62653332100A5F5F6C654E746F62654E110A766563746F725F6E6577123B736F6C3A3A66756E6374696F6E3A3A45524332303A3A7472616E7366657246726F6D5F5F616464726573735F616464726573735F75696E743235361338736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F7472616E736665725F5F616464726573735F616464726573735F75696E743235361437736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F617070726F76655F5F616464726573735F616464726573735F75696E743235361538736F6C3A3A66756E6374696F6E3A3A45524332303A3A6465637265617365416C6C6F77616E63655F5F616464726573735F75696E743235361638736F6C3A3A66756E6374696F6E3A3A45524332303A3A696E637265617365416C6C6F77616E63655F5F616464726573735F75696E743235361728736F6C3A3A66756E6374696F6E3A3A45524332303A3A62616C616E63654F665F5F61646472657373182C736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F6D696E745F5F616464726573735F75696E743235361930736F6C3A3A66756E6374696F6E3A3A45524332303A3A616C6C6F77616E63655F5F616464726573735F616464726573731A2C736F6C3A3A66756E6374696F6E3A3A45524332303A3A5F6275726E5F5F616464726573735F75696E743235361B057374617274"
                    .HexToBytes()
            );
            if (!VirtualMachine.VerifyContract(contract.ByteCode))
                throw new Exception("Unable to validate smart-contract code");

            var snapshot = stateManager.NewSnapshot();
            snapshot.Contracts.AddContract(UInt160Utils.Zero, contract);
            stateManager.Approve();

            Console.WriteLine("Contract Hash: " + hash.ToHex());

            for (var i = 0; i < 1; ++i)
            {
                var currentTime = TimeUtils.CurrentTimeMillis();
                var currentSnapshot = stateManager.NewSnapshot();

                var sender = "0x6bc32575acb8754886dc283c2c8ac54b1bd93195".HexToBytes().ToUInt160();
                var to = "0xfd893ce89186fc6861d339cb6ab5d75458e3daf3".HexToBytes().ToUInt160();

                var transactionReceipt = new TransactionReceipt();
                transactionReceipt.Transaction = new Transaction();
                transactionReceipt.Transaction.Value = 0.ToUInt256();
                var context = new InvocationContext(sender, currentSnapshot, transactionReceipt);

                {
                    /* ERC-20: name */
                    Console.WriteLine("\nERC-20: name()");
                    var input = ContractEncoder.Encode("name()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {"LAtoken"}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: symbol */
                    Console.WriteLine("\nERC-20: symbol()");
                    var input = ContractEncoder.Encode("symbol()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {"LA"}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: decimals */
                    Console.WriteLine("\nERC-20: decimals()");
                    var input = ContractEncoder.Encode("decimals()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {18}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: totalSupply */
                    Console.WriteLine("\nERC-20: totalSupply()");
                    var input = ContractEncoder.Encode("totalSupply()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {0}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* mint */
                    Console.WriteLine($"\nERC-20: mint({sender.ToHex()},{Money.FromDecimal(100)})");
                    var input = ContractEncoder.Encode("mint(address,uint256)", sender, Money.FromDecimal(100));
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: totalSupply */
                    Console.WriteLine("\nERC-20: totalSupply()");
                    var input = ContractEncoder.Encode("totalSupply()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {100}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({sender.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", sender);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {100}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: transfer */
                    Console.WriteLine($"\nERC-20: transfer({to.ToHex()},{Money.FromDecimal(50)})");
                    var input = ContractEncoder.Encode("transfer(address,uint256)", to, Money.FromDecimal(50));
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({sender.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", sender);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {50}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({to.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", to);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {50}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: approve */
                    Console.WriteLine($"\nERC-20: approve({to.ToHex()},{Money.FromDecimal(50)})");
                    var input = ContractEncoder.Encode("approve(address,uint256)", to, Money.FromDecimal(50));
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: allowance */
                    Console.WriteLine($"\nERC-20: allowance({sender.ToHex()},{to.ToHex()})");
                    var input = ContractEncoder.Encode("allowance(address,address)", sender, to);
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {50}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: increaseAllowance */
                    Console.WriteLine($"\nERC-20: increaseAllowance({to.ToHex()},{Money.FromDecimal(10)})");
                    var input = ContractEncoder.Encode("increaseAllowance(address,uint256)", to, Money.FromDecimal(10));
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: allowance */
                    Console.WriteLine($"\nERC-20: allowance({sender.ToHex()},{to.ToHex()})");
                    var input = ContractEncoder.Encode("allowance(address,address)", sender, to);
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {60}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: decreaseAllowance */
                    Console.WriteLine($"\nERC-20: decreaseAllowance({to.ToHex()},{Money.FromDecimal(10)})");
                    var input = ContractEncoder.Encode("decreaseAllowance(address,uint256)", to, Money.FromDecimal(10));
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: allowance */
                    Console.WriteLine($"\nERC-20: allowance({sender.ToHex()},{to.ToHex()})");
                    var input = ContractEncoder.Encode("allowance(address,address)", sender, to);
                    // Console.WriteLine($"ABI: {input.ToHex()}");
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {50}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: transferFrom */
                    Console.WriteLine($"\nERC-20: transferFrom({sender.ToHex()},{to.ToHex()},{Money.FromDecimal(50)})");
                    var input = ContractEncoder.Encode("transferFrom(address,address,uint256)", sender, to,
                        Money.FromDecimal(50));
                    // Console.WriteLine($"ABI: {input.ToHex()}");

                    // change sender
                    context = new InvocationContext(to, context.Snapshot, transactionReceipt);

                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({sender.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", sender);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {0}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({to.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", to);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {100}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* burn */
                    Console.WriteLine($"\nERC-20: burn({to.ToHex()},{Money.FromDecimal(30)})");
                    var input = ContractEncoder.Encode("burn(address,uint256)", to, Money.FromDecimal(30));
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {true}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: totalSupply */
                    Console.WriteLine("\nERC-20: totalSupply()");
                    var input = ContractEncoder.Encode("totalSupply()");
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {70}, {status.ReturnValue!.ToHex()}");
                }
                {
                    /* ERC-20: balanceOf */
                    Console.WriteLine($"\nERC-20: balanceOf({to.ToHex()}");
                    var input = ContractEncoder.Encode("balanceOf(address)", to);
                    // Console.WriteLine("ABI: " + input.ToHex());
                    var status = VirtualMachine.InvokeWasmContract(contract, context, input, 100_000_000_000_000UL);
                    if (status.Status != ExecutionStatus.Ok)
                    {
                        stateManager.Rollback();
                        Console.WriteLine("Contract execution failed: " + status.Status);
                        Console.WriteLine($"Result: {status.ReturnValue?.ToHex()}");
                        goto exit_mark;
                    }

                    Console.WriteLine($"Result: {70}, {status.ReturnValue!.ToHex()}");
                }

                stateManager.Approve();
            exit_mark:
                var elapsedTime = TimeUtils.CurrentTimeMillis() - currentTime;
                Console.WriteLine("Elapsed Time: " + elapsedTime + "ms");
            }
        }
    }
}